# Vector Pipeline

Embedding-based document search using Sentence Transformers + Qdrant.

- Ingestion pipeline: fetch â†’ extract â†’ embed â†’ upsert to Qdrant
- FastAPI REST API: semantic search over stored embeddings

## Project Structure

<pre>
vector_pipeline/
â”œâ”€â”€ main.py                  (ingestion entrypoint)
â”œâ”€â”€ main_api.py              (FastAPI API entrypoint)
â”‚
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ api/
â”‚   â”‚   â””â”€â”€ routes.py
â”‚   â””â”€â”€ models/
â”‚       â””â”€â”€ query_models.py
â”‚
â”œâ”€â”€ embeddings/
â”‚   â””â”€â”€ embedding_generator.py
â”œâ”€â”€ vectorstore/
â”‚   â””â”€â”€ qdrant_client.py
â”œâ”€â”€ fetchers/
â”œâ”€â”€ loaders/
â”œâ”€â”€ extractors/
â”œâ”€â”€ text_utils/
â””â”€â”€ .env
</pre>

## Prerequisites

- Python 3.9+
- pip
- Docker (to run Qdrant locally)

## Environment Variables

| Variable Name         | Description                                | Default Value |
|------------------------|--------------------------------------------|----------------|
| `QDRANT_HOST`          | Host address of the Qdrant instance        | `localhost`    |
| `QDRANT_PORT`          | Port number Qdrant listens on              | `6333`         |
| `QDRANT_COLLECTION`    | Name of the Qdrant collection used         | `documents`    |
| `QDRANT_DISTANCE`      | Vector distance metric (`Cosine`, `Dot`, `Euclid`) | `Cosine`       |
| `EMBEDDING_MODEL`      | Name of the SentenceTransformer model      | `sentence-transformers/all-MiniLM-L6-v2` |
| `EMBEDDING_DEVICE`     | Device for model inference (`cpu` or `cuda`) | `cpu`        |
| `LOG_LEVEL`            | Logging level for the application          | `INFO`         |

## Qdrant Setup

Qdrant is an open-source vector database used to store and search embeddings.

### ðŸ§± 1. Run Qdrant with Docker

Use the following command to start Qdrant locally and **keep data persisted** on disk:

```bash
docker run -d \
  -p 6333:6333 \
  -v $(pwd)/qdrant_storage:/qdrant/storage \
  --name qdrant \
  qdrant/qdrant
```
### ðŸ§± 2. Qdrant Docker Explanation

| Option | Description |
|--------|--------------|
| `-d` | Run the container in detached (background) mode |
| `-p 6333:6333` | Map Qdrantâ€™s default port (6333) to your localhost |
| `-v $(pwd)/qdrant_storage:/qdrant/storage` | Mount local folder `qdrant_storage/` for persistent data storage |
| `--name qdrant` | Assign a name (`qdrant`) to the container for easier management |

### ðŸ§¾ 3. Verify Qdrant is Running

Check the container status:
```bash
docker ps
```
You should see a container named qdrant in the list. Then open your browser at http://localhost:6333/dashboard to confirm Qdrant is up and running.

### ðŸ’¾ 4. Persistent storage

All data (collections, embeddings, payloads) are stored in ```qdrant_storage/```

This directory is created automatically in your project root and will survive container restarts.

To completely remove Qdrant and its data:

```bash
docker stop qdrant && docker rm qdrant
rm -rf qdrant_storage
```

### ðŸ”„ 5. Restarting Qdrant Later

Once Qdrant is installed, you can easily start or stop it:

```bash
docker start qdrant     # start existing container
docker stop qdrant      # stop it
```

## API setup

After completing ingestion and ensuring Qdrant is running, start the FastAPI service with:

```bash
uvicorn main_api:app --reload
```

```main_api``` â†’ the filename of your API entrypoint (main_api.py)
```app``` â†’ the FastAPI instance created inside that file
```--reload``` â†’ automatically restarts the server when code changes (useful in development)

By default, the API will start on http://127.0.0.1:8000

### ðŸ“˜ 1. Access API Documentation

Once the API is running, open your browser and navigate to:

ðŸ‘‰ [http://localhost:8000/docs](http://localhost:8000/docs)

Youâ€™ll see the **interactive Swagger UI**, automatically generated by FastAPI.

Thereâ€™s also an alternative documentation view at:

ðŸ‘‰ [http://localhost:8000/redoc](http://localhost:8000/redoc)

### ðŸ”Ž 2. Send a Test Query

In the Swagger UI, locate the `/api/search` endpoint and click **"Try it out"**.

